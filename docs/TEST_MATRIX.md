# テスト仕様書（テストマトリクス）

## 概要
このドキュメントは、バックエンド（Python/pytest）およびフロントエンド（TypeScript/Jest）の実装済みテストケースの一覧を記載しています。

## バックエンド（Python/pytest）テスト

### 1. データベース機能（db.py）

| ID | 対象ファイル | テストケース概要 | 区分(正常/異常) | 期待される動作 | 実装ステータス |
|----|------------|------------------|---------------|--------------|-------------|
| BE-DB-001 | db.py | 野菜ステータス初期化成功 | 正常系 | ドキュメントIDを返却し、statusが"processing"で保存される | ✅ 完了 |
| BE-DB-002 | db.py | DB未接続時の初期化処理 | 異常系 | mock-id-processingを返却してエラーを回避 | ✅ 完了 |
| BE-DB-003 | db.py | 初期化時のデータベースエラー | 異常系 | error-idを返却してエラーをハンドリング | ✅ 完了 |
| BE-DB-004 | db.py | 野菜ステータス更新成功（データあり） | 正常系 | statusとinstructionsが正しく更新される | ✅ 完了 |
| BE-DB-005 | db.py | 野菜ステータス更新成功（データなし） | 正常系 | statusのみが更新される | ✅ 完了 |
| BE-DB-006 | db.py | DB未接続時の更新処理 | 異常系 | エラーを発生させずに処理を終了 | ✅ 完了 |
| BE-DB-007 | db.py | 全野菜データ取得成功 | 正常系 | すべての野菜データのリストを返却 | ✅ 完了 |
| BE-DB-008 | db.py | DB未接続時の全データ取得 | 異常系 | 空のリストを返却 | ✅ 完了 |
| BE-DB-009 | db.py | 最新野菜データ取得成功 | 正常系 | 最新の野菜データを返却 | ✅ 完了 |
| BE-DB-010 | db.py | データなし時の最新取得 | 正常系 | Noneを返却 | ✅ 完了 |
| BE-DB-011 | db.py | DB未接続時の最新取得 | 異常系 | Noneを返却 | ✅ 完了 |

### 2. エージェント機能（agent.py）

| ID | 対象ファイル | テストケース概要 | 区分(正常/異常) | 期待される動作 | 実装ステータス |
|----|------------|------------------|---------------|--------------|-------------|
| BE-AG-001 | agent.py | 認証ヘッダー取得成功 | 正常系 | AuthorizationヘッダーとトークンをBearerで返却 | ✅ 完了 |
| BE-AG-002 | agent.py | エージェント位置とID取得成功 | 正常系 | locationとagent_idを正しくパース | ✅ 完了 |
| BE-AG-003 | agent.py | AGENT_ENDPOINT未設定エラー | 異常系 | ValueErrorを発生 | ✅ 完了 |
| BE-AG-004 | agent.py | AGENT_ENDPOINT不正フォーマット | 異常系 | ValueErrorを発生 | ✅ 完了 |
| BE-AG-005 | agent.py | セッション作成成功（即時） | 正常系 | セッション名を返却 | ✅ 完了 |
| BE-AG-006 | agent.py | セッション作成成功（LRO経由） | 正常系 | LRO完了後にセッション名を返却 | ✅ 完了 |
| BE-AG-007 | agent.py | セッションクエリ成功 | 正常系 | SSEストリームからテキストを結合して返却 | ✅ 完了 |
| BE-AG-008 | agent.py | セッションクエリ空レスポンス | 正常系 | 空文字列を返却 | ✅ 完了 |
| BE-AG-009 | agent.py | 天気取得成功 | 正常系 | 天気情報を返却 | ✅ 完了 |
| BE-AG-010 | agent.py | 天気取得エラー | 異常系 | エラーメッセージを含む日本語メッセージを返却 | ✅ 完了 |

### 3. APIエンドポイント（main.py）

| ID | 対象ファイル | テストケース概要 | 区分(正常/異常) | 期待される動作 | 実装ステータス |
|----|------------|------------------|---------------|--------------|-------------|
| BE-API-001 | main.py | /api/weather 成功 | 正常系 | 200応答と天気メッセージを返却 | ✅ 完了 |
| BE-API-002 | main.py | /api/weather エラー処理 | 異常系 | 500エラーを返却 | ✅ 完了 |
| BE-API-003 | main.py | /api/sensors/latest 成功 | 正常系 | 最新センサーログを返却 | ✅ 完了 |
| BE-API-004 | main.py | /api/sensors/latest データなし | 正常系 | 空のオブジェクトを返却 | ✅ 完了 |
| BE-API-005 | main.py | /api/sensor-history 成功 | 正常系 | センサー履歴データを返却 | ✅ 完了 |
| BE-API-006 | main.py | /api/sensor-history エラー | 異常系 | 500エラーを返却 | ✅ 完了 |
| BE-API-007 | main.py | /api/vegetables/latest 成功 | 正常系 | 最新野菜データを返却 | ✅ 完了 |
| BE-API-008 | main.py | /api/vegetables/latest データなし | 正常系 | 空のオブジェクトを返却 | ✅ 完了 |
| BE-API-009 | main.py | /api/vegetables リスト取得 | 正常系 | 野菜リストを返却 | ✅ 完了 |
| BE-API-010 | main.py | /api/register-seed 成功 | 正常系 | accepted状態とドキュメントIDを返却 | ✅ 完了 |
| BE-API-011 | main.py | /api/register-seed 解析エラー | 異常系 | 500エラーを返却 | ✅ 完了 |
| BE-API-012 | main.py | /api/seed-guide/jobs 作成成功 | 正常系 | job_idを返却 | ✅ 完了 |
| BE-API-013 | main.py | /api/seed-guide/jobs/{job_id} 存在しない | 異常系 | 404エラーを返却 | ✅ 完了 |

### 4. 種分析サービス（seed_service.py）

| ID | 対象ファイル | テストケース概要 | 区分(正常/異常) | 期待される動作 | 実装ステータス |
|----|------------|------------------|---------------|--------------|-------------|
| BE-SEED-001 | seed_service.py | 種画像解析と案内生成成功 | 正常系 | ステップリストと画像データを返却 | ✅ 完了 |
| BE-SEED-002 | seed_service.py | APIキー未設定エラー | 異常系 | RuntimeErrorを発生 | ✅ 完了 |
| BE-SEED-003 | seed_service.py | API呼び出し失敗 | 異常系 | RuntimeErrorを発生 | ✅ 完了 |
| BE-SEED-004 | seed_service.py | プログレスコールバック付き実行 | 正常系 | 進捗メッセージをコールバック、ステップデータを返却 | ✅ 完了 |

### 5. ユーティリティ（test_utils.py）

| ID | 対象ファイル | テストケース概要 | 区分(正常/異常) | 期待される動作 | 実装ステータス |
|----|------------|------------------|---------------|--------------|-------------|
| BE-UTIL-001 | test_utils.py | pytest動作確認 | 正常系 | pytestが正常に動作することを確認 | ✅ 完了 |
| BE-UTIL-002 | test_utils.py | 基本的なアサーション | 正常系 | 数値演算が正常に動作することを確認 | ✅ 完了 |
| BE-UTIL-003 | test_utils.py | 文字列操作テスト | 正常系 | Python文字列操作が正常に動作することを確認 | ✅ 完了 |
| BE-UTIL-004 | test_utils.py | リスト操作テスト | 正常系 | Pythonリスト操作が正常に動作することを確認 | ✅ 完了 |

## フロントエンド（TypeScript/Jest）テスト

### 1. ユーティリティ関数（lib/utils.ts）

| ID | 対象ファイル | テストケース概要 | 区分(正常/異常) | 期待される動作 | 実装ステータス |
|----|------------|------------------|---------------|--------------|-------------|
| FE-UTIL-001 | lib/utils.ts | クラス名マージ | 正常系 | 複数のクラス名を正しく結合 | ✅ 完了 |
| FE-UTIL-002 | lib/utils.ts | 条件付きクラス処理 | 正常系 | falseの条件のクラスを除外 | ✅ 完了 |
| FE-UTIL-003 | lib/utils.ts | undefined/null処理 | 正常系 | undefined/nullを無視してクラスを結合 | ✅ 完了 |
| FE-UTIL-004 | lib/utils.ts | Tailwindクラスマージ | 正常系 | 重複するTailwindクラスを適切にマージ | ✅ 完了 |
| FE-UTIL-005 | lib/utils.ts | 空入力処理 | 正常系 | 空文字列を返却 | ✅ 完了 |
| FE-UTIL-006 | lib/utils.ts | 配列入力処理 | 正常系 | 配列内のクラスを結合 | ✅ 完了 |
| FE-UTIL-007 | lib/utils.ts | オブジェクト条件付きクラス | 正常系 | trueのプロパティのみをクラスとして使用 | ✅ 完了 |

### 2. MetricCardコンポーネント

| ID | 対象ファイル | テストケース概要 | 区分(正常/異常) | 期待される動作 | 実装ステータス |
|----|------------|------------------|---------------|--------------|-------------|
| FE-COMP-001 | metric-card.tsx | 基本プロパティでレンダリング | 正常系 | タイトル、値、単位、アイコンが表示される | ✅ 完了 |
| FE-COMP-002 | metric-card.tsx | デフォルトステータス（normal） | 正常系 | text-primaryクラスが適用される | ✅ 完了 |
| FE-COMP-003 | metric-card.tsx | warningステータス | 正常系 | text-chart-2クラスが適用される | ✅ 完了 |
| FE-COMP-004 | metric-card.tsx | criticalステータス | 正常系 | text-destructiveクラスが適用される | ✅ 完了 |
| FE-COMP-005 | metric-card.tsx | アイコン表示 | 正常系 | SVGアイコンが正しく表示される | ✅ 完了 |

### 3. WeatherCardコンポーネント

| ID | 対象ファイル | テストケース概要 | 区分(正常/異常) | 期待される動作 | 実装ステータス |
|----|------------|------------------|---------------|--------------|-------------|
| FE-COMP-006 | weather-card.tsx | タイトル表示 | 正常系 | "本日の天気予報"が表示される | ✅ 完了 |
| FE-COMP-007 | weather-card.tsx | 現在の気温表示 | 正常系 | "26°C"が表示される | ✅ 完了 |
| FE-COMP-008 | weather-card.tsx | 天気説明表示 | 正常系 | "晴れ時々曇り"が表示される | ✅ 完了 |
| FE-COMP-009 | weather-card.tsx | 風速表示 | 正常系 | "3 m/s"が表示される | ✅ 完了 |
| FE-COMP-010 | weather-card.tsx | 日の出時刻表示 | 正常系 | "5:42"が表示される | ✅ 完了 |
| FE-COMP-011 | weather-card.tsx | 日の入時刻表示 | 正常系 | "18:23"が表示される | ✅ 完了 |
| FE-COMP-012 | weather-card.tsx | 時間別予報時刻 | 正常系 | 9時、12時、15時、18時が表示される | ✅ 完了 |
| FE-COMP-013 | weather-card.tsx | 時間別予報気温 | 正常系 | 24°、28°、27°、23°が表示される | ✅ 完了 |
| FE-COMP-014 | weather-card.tsx | 複数アイコン表示 | 正常系 | 複数の天気アイコンが表示される | ✅ 完了 |

### 4. GrowthStageCardコンポーネント

| ID | 対象ファイル | テストケース概要 | 区分(正常/異常) | 期待される動作 | 実装ステータス |
|----|------------|------------------|---------------|--------------|-------------|
| FE-COMP-015 | growth-stage-card.tsx | タイトル表示 | 正常系 | "生育段階"が表示される | ✅ 完了 |
| FE-COMP-016 | growth-stage-card.tsx | 現在の段階表示 | 正常系 | "開花期"が表示される | ✅ 完了 |
| FE-COMP-017 | growth-stage-card.tsx | 播種日数表示 | 正常系 | "播種から42日目"が表示される | ✅ 完了 |
| FE-COMP-018 | growth-stage-card.tsx | 進捗率表示 | 正常系 | "40%"が表示される | ✅ 完了 |
| FE-COMP-019 | growth-stage-card.tsx | 進捗ラベル表示 | 正常系 | "進捗"が表示される | ✅ 完了 |
| FE-COMP-020 | growth-stage-card.tsx | 全段階略称表示 | 正常系 | 発芽、栄養、開花、結実、収穫が表示される | ✅ 完了 |
| FE-COMP-021 | growth-stage-card.tsx | プログレスバー表示 | 正常系 | プログレスバーが表示される | ✅ 完了 |
| FE-COMP-022 | growth-stage-card.tsx | タイムラインドット表示 | 正常系 | 5つの段階ドットが表示される | ✅ 完了 |
| FE-COMP-023 | growth-stage-card.tsx | アイコン表示 | 正常系 | SVGアイコンが表示される | ✅ 完了 |

## テスト実行方法

### バックエンド（Python）
```bash
cd backend
pip install -r requirements.txt
pytest
```

### フロントエンド（TypeScript）
```bash
cd frontend
npm install --legacy-peer-deps
npm test
```

## テストカバレッジ

### バックエンド
- **合計テストケース数**: 42件
- **正常系テスト**: 31件
- **異常系テスト**: 11件
- **実装完了率**: 100%

### フロントエンド
- **合計テストケース数**: 30件
- **正常系テスト**: 30件
- **異常系テスト**: 0件
- **実装完了率**: 100%

## 備考
- すべてのテストケースは実装済みで、テストが通過することを確認しています
- バックエンドは主要な機能の正常系・異常系をカバー
- フロントエンドはUI コンポーネントの表示と動作をカバー
- 今後の追加機能に対しても同様の基準でテストを実装していく予定です
